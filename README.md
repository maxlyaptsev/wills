Привет

Дать доступ к целому проекту не могу - безопасность, все дела. Приведу некоторые куски кода с объяснением что зачем. С разбивкой по категориям. 

## Работа с внешними api
### Задача: получить посты по тегам из вконтакте, выдать в формате, удобном для мобильного приложения.

Решение: найти библиотеку где реализован интерфейс работы с вк, сделать свою надстройку для получения нужных данных.
Взял [этот sdk](https://github.com/bocharsky-bw/vkontakte-php-sdk)

Решение [/src/vkontakte.php](src/vkontakte.php)

### Instagram: задача с некоторой периодичностью подтягивать фотографии из аккаунта.
Получаем токен, для http запросов используем guzzle. В последнем обновлении апи инстаграма позволяет получать только последние 20 постов, поэтому частота запуска скрипта должна соответствовать плотности публикаций.
Ставим на крон, [/src/instagram.php](src/instagram.php)
Здесь реализован агент который занимается роутингом крон задач. Крон каждую минуту его дергает, в агенте указывается точное время или частота вызова метода\функции, в ответ необходимо отдать вызов функции, такой замедленно-рекурсивный способ перезапуска.
```php
    public function agent()
    {
        $this->start();
        return 'Triangle\Services\Instagram\Import::getInstance()->agent();';
    }
```
Кстати на нем же делал более интересную вещь - очередь. Из crm периодически тянутся некие продукты
### Реализация простой очереди
```php
public static function updateProductsFromCrmAgent($timeFrom)
	{
		$time = \DateTime::createFromFormat('d.m.Y H:i:s', $timeFrom);
		$curTime = (new \DateTime());

		$import = new static();
		$import->updateProductsFromCrm($time);
		return '\Synergy\Exchange\Products::updateProductsFromCrmAgent("'. $curTime->format('d.m.Y H:i:s').'");';
	}
```
В аргументе указана определенное время - тянем продукты, которые изменились или добавились начиная с этого времени и позже, а возвращаем текущее время после выполнения операции. В следующий раз будут тянутся продукты начиная с обновленного метода. Если что-то пойдет не так, время останется преждим, и будут новые попытки получить нужную информацию. Параллельно, оповещая кого нужно.
